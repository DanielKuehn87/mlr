context("getFeatureImportance")

test_that("getFeatureImportance", {
  
  #type 2 for random Forest should work without setting importance
  lrn = makeLearner("classif.randomForest")
  mod = train(lrn, binaryclass.task)
  feat.imp = getFeatureImportance(mod, type = 2)
  expect_is(feat.imp, "numeric")
  expect_equal(names(feat.imp), mod$features)
  
  #type 1 shouldn't
  expect_error(getFeatureImportance(mod, type = 1), regexp = "parameter 'importance' is TRUE")
  
  lrn = setHyperPars(lrn, importance = TRUE)
  mod = train(lrn, binaryclass.task)
  feat.imp = getFeatureImportance(mod, type = 1)
  expect_is(feat.imp, "numeric")
  expect_equal(names(feat.imp), mod$features)
  
  #regression learner
  lrn = makeLearner("regr.gbm")
  mod = train(lrn, regr.task)
  feat.imp = getFeatureImportance(mod)
  expect_is(feat.imp, "numeric")
  expect_equal(names(feat.imp), mod$features)
  
  #For learners without the possibility to calculate feature importance a meaningfull error should
  #be returned
  lrn = makeLearner("classif.qda")
  mod = train(lrn, binaryclass.task)
  expect_error(getFeatureImportance(mod), regexp = "no applicable method")
})
